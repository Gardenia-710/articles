---
title: "CloudflareのDNS管理でTerraformデビューしてみた"
emoji: "🙌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["terraform", "cloudflare"]
published: false
---
## IaCってなんだ？
最近IaCという言葉をよく聞くようになり、それと同時にTerraformというものもよく聞くようになった。

IaCってなんだ？と思い調べてみると[AWSのドキュメント](https://aws.amazon.com/jp/what-is/iac/)を発見。

https://aws.amazon.com/jp/what-is/iac/

> Infrastructure as Code (IaC) とは、手動のプロセスや設定の代わりにコードを使用してコンピューティングインフラストラクチャをプロビジョニングおよびサポートできることをいいます。

とのことらしい。

要するに今までGCPやAWSなどのインフラに関する設定をコンソール画面で行っていたが、それをコードでできるようにしようっていうものらしい。

それにより以下のメリットがあるとのこと。

1. 環境を簡単に複製できる
2. 設定エラーの低減ができる
3. 設定がまとまるので管理がしやすくなる

企業のような大きいサービスをいくつも提供していたり、複数の環境が必要な場合であればIaCによるメリットはかなり大きいかなと思うが、個人の趣味開発程度でIaCが必要になるのかがイマイチイメージがわかない。

ということで実際にやってみて判断してみる。

## IaCにはTerraformらしい
IaCツールとは簡単に調べてみたところ主に以下の2つが出てきた。

1つ目は「Terraform」で、2つ目が「Cloudformation」というものである。

上記の比較については少し前の話ではあるが、Zennに[IaCツールの比較](https://zenn.dev/maniizu3110/articles/65d641519f14a5)という記事があったので読んでみた。

https://zenn.dev/maniizu3110/articles/65d641519f14a5

とりあえずTerraformを選択しておくのが良いとのことで、「Terraform 入門」みたいな感じでGoogle検索をするとたくさん記事が出てきたので、インフラ知識があまりない僕でもできるかもしれないということでTerraformを使ってIaCデビューしてみることにした。

## Terraformを使ってみよう
兎にも角にもまずはインストールをする。

今回はmacOSで使用するので、[Terraform公式ドキュメント](https://developer.hashicorp.com/terraform/tutorials/gcp-get-started/install-cli)を参考にインストールする。

https://developer.hashicorp.com/terraform/tutorials/gcp-get-started/install-cli

インストールは以下の通り。

```zsh
$ brew tap hashicorp/tap
$ brew install hashicorp/tap/terraform

$ terraform -v
Terraform v1.6.6
on darwin_amd64
```

これでインストールが完了した。

インストール自体はめっちゃ簡単でとても良い。

## とりあえずお試しでCloudflareをいじってみる
今個人的にGCPとかAWSにおいているプロジェクトがないので、お試しということもありとりあえず自身のドメインのDNSをCloudflareで管理しているのでその部分をTerraformで管理できるようにしてみる。

こちらに関しても[Cloudflareのドキュメント](https://developers.cloudflare.com/terraform/)があるのでこれのチュートリアルを参考に進めていく。

https://developers.cloudflare.com/terraform/

ひとまず各種ファイルを準備する。

```zsh
$ touch main.tf provider.tf variables.tf terraform.tfvars

$ tree
.
├── dns.tf
├── provider.tf
├── terraform.tfvars
└── variables.tf
```

このファイル構成が正解なのかは分からないが、ドキュメントを見る限りこんな感じが良いらしい。

それぞれのファイルの役割として、ふんわりと自分なりに理解しているのは以下の通りである。

- provider.tf
  - Terraformでインフラを操作するためには、Providerと呼ばれるインフラとやり取りするためのプラグインを設定する必要があり、その設定を記述する。
- dns.tf
  - 実際にDNSに関する設定を記述するファイル。
- variables.tf
  - このディレクトリにあるTerraformのファイルの中で使用する変数について記述するファイル。
- terraform.tfvars
  - 変数を記述するファイル。

## 既存環境の取り込み

## その他のリソースの操作

## まとめ